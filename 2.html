<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>TVBox AES-128-CBC å·¥å…·</title>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
<style>
/* ========= ç»Ÿä¸€ index æç®€é£ ========= */
*{box-sizing:border-box}
body{
    font-family:"Microsoft YaHei",Roboto,"Helvetica Neue",Arial,sans-serif;
    background:#f9fafb;
    color:#374151;
    margin:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    line-height:1.5
}
.container{
    width:100%;
    max-width:600px;
    margin:0 auto 24px;   /* é¡¶éƒ¨å¯¼èˆªå·²å›ºå®šï¼Œå»æ‰ä¸Šè¾¹è· */
    padding:16px;
    background:#fff;
    border-radius:0 0 10px 10px; /* é¡¶éƒ¨å¯¼èˆªå·²åœ†è§’ï¼Œå†…å®¹åŒºåªä¿ç•™åº•éƒ¨åœ†è§’ */
    box-shadow:0 0 6px rgba(0,0,0,.04);
    flex:1
}
h2{
    font-size:18px;
    text-align:center;
    margin:0 0 16px;
    color:#4b5563
}
label{font-size:14px;color:#374151;margin-bottom:6px;display:block}
input[type=text],textarea{
    width:100%;
    border:1px solid #d1d5db;
    border-radius:6px;
    padding:10px 12px;
    font-size:15px;
    resize:none;
    transition:border-color .2s,box-shadow .2s
}
input[type=text]:focus,textarea:focus{
    outline:none;
    border-color:#4285f4;
    box-shadow:0 0 0 2px rgba(66,133,244,.15)
}
textarea{min-height:140px}
input[type=file]{display:none}

.btn-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(90px,1fr));
    gap:8px;
    margin:14px 0
}
button,.upload-btn{
    border:none;
    border-radius:6px;
    padding:12px 0;
    font-size:15px;
    font-weight:600;
    color:#fff;
    cursor:pointer;
    transition:filter .2s
}
button:hover,.upload-btn:hover{filter:brightness(1.1)}
.enc{background:#f093fb}
.dec{background:#06d6a0}
.copy{background:#f7b801}
.clear{background:#ef476f}
.down{background:#4895ef}
.upload-btn{background:#4285f4;grid-column:1/-1}

/* ===== é¡¶éƒ¨å¯¼èˆª ===== */
.top-nav{
    background:#4285f4;
    text-align:center;
    padding:12px 8px;
    font-size:0
}
.top-nav a{
    color:#fff;
    font-size:13px;
    margin:0 8px;
    display:inline-block;
    padding:4px 6px;
    cursor:pointer;
    text-decoration:none
}
.top-nav a:hover{text-decoration:underline}

.footer-links{
    background:#4285f4;
    text-align:center;
    padding:12px 8px;
    margin-top:auto;
    font-size:0
}
.footer-links a{
    color:#fff;
    font-size:13px;
    margin:0 8px;
    display:inline-block;
    padding:4px 6px;
    cursor:pointer;
    text-decoration:none
}
.footer-links a:hover{text-decoration:underline}
.copyright{
    background:#f8fafc;
    font-size:12px;
    color:#64748b;
    text-align:center;
    padding:10px 0;
    border-top:1px solid #f0f0f0
}

@media(max-width:600px){
    .container{padding:12px;margin:0 auto 16px}   /* ç§»åŠ¨ç«¯ä¿æŒåº•éƒ¨é—´è· */
    h2{font-size:16px;margin-bottom:12px}
    input[type=text],textarea{font-size:14px;padding:8px 10px}
    .btn-grid{grid-template-columns:repeat(2,1fr);gap:6px}
    button,.upload-btn{font-size:14px;padding:10px 0}
    .footer-links a{font-size:12px;margin:0 6px}
    .top-nav a{font-size:12px;margin:0 6px}
}
</style>
</head>
<body>

<!-- é¡¶éƒ¨å¯¼èˆª -->
<div class="top-nav">
    <a href="./index.html">æˆ‘çš„ä¸»é¡µ</a>
    <a href="./1.html">æ ¼å¼è½¬æ¢</a>
    <a href="./2.html">åŠ å¯†å·¥å…·</a>
    <a href="./pl/html">æ‰¹é‡å·¥å…·</a>
</div>

<div class="container">
    <h2>TVBox AES-128-CBC å·¥å…·</h2>

    <label>å¯†é’¥ Key</label>
    <input type="text" id="key" placeholder="ä»»æ„é•¿åº¦ï¼Œä¸è¶³16ä½è‡ªåŠ¨è¡¥0" value="123456"/>

    <div class="btn-grid">
        <button class="enc" id="btnEnc">åŠ å¯†</button>
        <button class="down" id="btnDown">ä¸‹è½½</button>
        <button class="dec" id="btnDec">è§£å¯†</button>
        <button class="copy" id="btnCopy">å¤åˆ¶</button>
        <button class="clear" id="btnClear">æ¸…é™¤</button>
    </div>
    <label for="upload" class="upload-btn">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</label>
    <input type="file" id="upload" accept="text/plain"/>

    <label>è¾“å…¥ï¼ˆæ˜æ–‡/å¯†æ–‡ï¼‰</label>
    <textarea id="in" placeholder="ç²˜è´´æˆ–ä¸Šä¼ æ–‡ä»¶"></textarea>

    <label>è¾“å‡ºç»“æœ</label>
    <textarea id="out" placeholder="ç»“æœè‡ªåŠ¨æ˜¾ç¤º" readonly></textarea>
</div>

<!-- åº•éƒ¨é“¾æ¥ -->
<div class="footer-links">
    <a data-tooltip="æ‰“å¼€æˆ‘çš„å·¥å…·ç®±" onclick="openToolbox()">æˆ‘çš„å·¥å…·ç®±</a>
    <a data-tooltip="ç‚¹å‡»æ˜¾ç¤ºé‚®ç®±åœ°å€" onclick="showEmail()">æˆ‘çš„é‚®ç®±</a>
    <a data-tooltip="è®¿é—®æˆ‘çš„å¾®åš" onclick="openWeibo()">æˆ‘çš„å¾®åš</a>
    <a data-tooltip="è®¿é—®æ ¼å¼è½¬æ¢å·¥å…·" onclick="openNav1()">æ ¼å¼è½¬æ¢</a>
    <a data-tooltip="è®¿é—®åŠ å¯†å·¥å…·" onclick="openNav2()">åŠ å¯†å·¥å…·</a>
    <a data-tooltip="è®¿é—®æ ¼å¼è½¬æ¢å·¥å…·" onclick="openFormatTool()">æ ¼å¼è½¬æ¢å·¥å…·</a>
</div>
<div class="copyright">Copyright Â© 2025 å¤šåŠŸèƒ½ç½‘ç«™ | ç‰ˆæƒæ‰€æœ‰</div>

<script>
/* ---------- å·¥å…·å‡½æ•° ---------- */
const pad16 = str => {
    const buf = CryptoJS.enc.Utf8.parse(str);
    const len = 16 - buf.sigBytes % 16;
    return buf.concat(CryptoJS.lib.WordArray.random(len));
};
const toHex  = wa => wa.toString(CryptoJS.enc.Hex);
const fromHex = hex => CryptoJS.enc.Hex.parse(hex);
let lastCipher = '';

/* ---------- åŠ å¯† ---------- */
document.getElementById('btnEnc').onclick = () => {
    const keyStr = document.getElementById('key').value;
    const key = pad16(keyStr);
    const iv  = CryptoJS.lib.WordArray.random(16);
    const plain = CryptoJS.enc.Utf8.parse(document.getElementById('in').value);

    const c = CryptoJS.AES.encrypt(plain, key, {iv, mode:CryptoJS.mode.CBC, padding:CryptoJS.pad.Pkcs7});
    const keyHex = toHex(CryptoJS.enc.Utf8.parse('$#' + keyStr + '#$'));
    lastCipher = keyHex + c.ciphertext.toString() + toHex(iv);
    document.getElementById('out').value = lastCipher;
};

/* ---------- ä¸‹è½½ ---------- */
document.getElementById('btnDown').onclick = () => {
    if (!lastCipher) return alert('è¯·å…ˆåŠ å¯†ï¼');
    const blob = new Blob([lastCipher], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'jk.txt';
    a.click();
};

/* ---------- è§£å¯† ---------- */
document.getElementById('btnDec').onclick = () => {
    const data = document.getElementById('in').value.trim();
    if (!data) return alert('è¯·è¾“å…¥æˆ–ä¸Šä¼ å¯†æ–‡');
    const p1 = data.indexOf('$#'), p2 = data.indexOf('#$');
    if (p1 === -1 || p2 === -1) return alert('æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘$#...#$');
    const keyHex = data.slice(p1 + 4, p2);
    const keyStr = CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Hex.parse(keyHex));
    const iv   = fromHex(data.slice(-32));
    const cipher = fromHex(data.slice(p2 + 4, -32));
    const d = CryptoJS.AES.decrypt({ciphertext:cipher}, pad16(keyStr), {iv, mode:CryptoJS.mode.CBC, padding:CryptoJS.pad.Pkcs7});
    const plain = d.toString(CryptoJS.enc.Utf8);
    if (!plain) return alert('è§£å¯†å¤±è´¥ï¼Œæ£€æŸ¥å¯†é’¥æˆ–å¯†æ–‡');
    document.getElementById('out').value = plain;
};

/* ---------- å¤åˆ¶ ---------- */
document.getElementById('btnCopy').onclick = function () {
    const o = document.getElementById('out');
    o.select();
    document.execCommand('copy');
    const t = this.textContent; this.textContent = 'å·²å¤åˆ¶ï¼';
    setTimeout(() => this.textContent = t, 1200);
};

/* ---------- æ¸…é™¤ ---------- */
document.getElementById('btnClear').onclick = () => {
    document.getElementById('in').value = '';
    document.getElementById('out').value = '';
    lastCipher = '';
};

/* ---------- ä¸Šä¼  ---------- */
document.getElementById('upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        const txt = reader.result;
        document.getElementById('in').value = txt;
        if (/^[0-9a-fA-F]+$/.test(txt.trim()) && txt.includes('$#')) {
            const m = txt.match(/\$#([0-9a-fA-F]+)#\$/);
            if (m) try {
                document.getElementById('key').value = CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Hex.parse(m[1]));
            } catch {}
        }
    };
    reader.readAsText(file);
};

/* ---------- åº•éƒ¨é“¾æ¥åŠŸèƒ½ ---------- */
function showEmail() {confirm('æˆ‘çš„é‚®ç®±åœ°å€æ˜¯ï¼šgyjune@126.com')}
function openToolbox() {window.open('https://link3.cc/gyjune', '_blank')}
function openWeibo() {window.open('https://weibo.com/u/1771411553', '_blank')}
function openNav1() {window.open('./1.html', '_blank')}
function openNav2() {window.open('./2.html', '_blank')}
function openFormatTool() {window.open('./3.html', '_blank')}
</script>
</body>
</html>