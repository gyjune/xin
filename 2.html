<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TVBox AES-128-CBC å·¥å…·</title>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
<style>
*{box-sizing:border-box}
body{margin:0;font:14px/1.5 "Microsoft YaHei";background:#f9fafb;color:#374151;display:flex;flex-direction:column;min-height:100vh}
.top-nav,.footer-links{background:#4285f4;text-align:center;padding:10px 0;font-size:0}
.top-nav a,.footer-links a{color:#fff;font-size:13px;margin:0 8px;padding:4px 6px;text-decoration:none}
.top-nav a:hover,.footer-links a:hover{text-decoration:underline}
.container{width:100%;max-width:600px;margin:0 auto 24px;padding:16px;background:#fff;border-radius:0 0 8px 8px;box-shadow:0 0 6px rgba(0,0,0,.04);flex:1}
h2{font-size:18px;text-align:center;margin:0 0 16px}
label{font-size:14px;margin-bottom:6px;display:block}
input[type=text],textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:15px;resize:none}
textarea{min-height:140px}
.btn-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(90px,1fr));gap:8px;margin:14px 0}
button,.upload-btn{border:none;border-radius:6px;padding:12px 0;font-size:15px;font-weight:600;color:#fff;cursor:pointer;transition:filter .2s}
button:hover,.upload-btn:hover{filter:brightness(1.1)}
.enc{background:#f093fb}.dec{background:#06d6a0}.copy{background:#f7b801}.clear{background:#ef476f}.down{background:#4895ef}
.upload-btn{background:#4285f4;grid-column:1/-1}input[type=file]{display:none}
.copyright{background:#f8fafc;font-size:12px;color:#64748b;text-align:center;padding:10px 0;border-top:1px solid #f0f0f0}
@media(max-width:600px){.btn-grid{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>

<!-- é¡¶éƒ¨å¯¼èˆª -->
<div class="top-nav">
    <a href="./index.html">æˆ‘çš„ä¸»é¡µ</a>
    <a href="./1.html">æ ¼å¼è½¬æ¢</a>
    <a href="./2.html">åŠ å¯†å·¥å…·</a>
    <a href="./pl/html">æ‰¹é‡å·¥å…·</a>
</div>

<div class="container">
    <h2>TVBox AES-128-CBC å·¥å…·</h2>

    <label>å¯†é’¥ Key</label>
    <input type="text" id="key" placeholder="ä»»æ„é•¿åº¦ï¼Œä¸è¶³16ä½è‡ªåŠ¨è¡¥0" value="123456"/>

    <div class="btn-grid">
        <button class="enc" id="btnEnc">åŠ å¯†</button>
        <button class="dec" id="btnDec">è§£å¯†</button>
        <button class="copy" id="btnCopy">å¤åˆ¶</button>
        <button class="clear" id="btnClear">æ¸…é™¤</button>
        <button class="down" id="btnDown">ä¸‹è½½</button>
    </div>
    <label for="upload" class="upload-btn">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</label>
    <input type="file" id="upload" accept="text/plain"/>

    <label>è¾“å…¥ï¼ˆæ˜æ–‡/å¯†æ–‡ï¼‰</label>
    <textarea id="in" placeholder="ç²˜è´´æˆ–ä¸Šä¼ æ–‡ä»¶"></textarea>

    <label>è¾“å‡ºç»“æœ</label>
    <textarea id="out" placeholder="ç»“æœè‡ªåŠ¨æ˜¾ç¤º" readonly></textarea>
</div>

<!-- åº•éƒ¨é“¾æ¥ -->
<div class="footer-links">
    <a onclick="window.open('https://link3.cc/gyjune')">æˆ‘çš„å·¥å…·ç®±</a>
    <a onclick="alert('é‚®ç®±ï¼šgyjune@126.com')">æˆ‘çš„é‚®ç®±</a>
    <a onclick="window.open('https://weibo.com/u/1771411553')">æˆ‘çš„å¾®åš</a>
    <a href="./1.html">æ ¼å¼è½¬æ¢</a>
    <a href="./2.html">åŠ å¯†å·¥å…·</a>
    <a href="./3.html">æ ¼å¼è½¬æ¢å·¥å…·</a>
</div>
<div class="copyright">Copyright Â© 2025 å¤šåŠŸèƒ½ç½‘ç«™ | ç‰ˆæƒæ‰€æœ‰</div>

<script>
/* ---------- åŸºç¡€å·¥å…· ---------- */
const pad16 = str => {
    const buf = CryptoJS.enc.Utf8.parse(str);
    const len = 16 - (buf.sigBytes % 16 || 16);
    return buf.concat(CryptoJS.lib.WordArray.random(len));
};
const toHex = wa => wa.toString(CryptoJS.enc.Hex);
const fromHex = hex => CryptoJS.enc.Hex.parse(hex);
let lastCipher = '';

/* ---------- åŠ å¯† ---------- */
document.getElementById('btnEnc').onclick = () => {
    const keyStr = document.getElementById('key').value;
    const key = pad16(keyStr);
    const iv  = CryptoJS.lib.WordArray.random(16);
    const plain = CryptoJS.enc.Utf8.parse(document.getElementById('in').value);
    const c = CryptoJS.AES.encrypt(plain, key, {iv, mode:CryptoJS.mode.CBC, padding:CryptoJS.pad.Pkcs7});
    const keyHex = toHex(CryptoJS.enc.Utf8.parse('$#' + keyStr + '#$'));
    lastCipher = keyHex + c.ciphertext.toString() + toHex(iv);
    document.getElementById('out').value = lastCipher;
};

/* ---------- è§£å¯† ---------- */
document.getElementById('btnDec').onclick = () => {
    const data = document.getElementById('in').value.trim();
    if (!data) return alert('è¯·è¾“å…¥æˆ–ä¸Šä¼ å¯†æ–‡');
    const p1 = data.indexOf('$#'), p2 = data.indexOf('#$');
    if (p1 === -1 || p2 === -1) return alert('æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘$#...#$');
    const keyHex = data.slice(p1 + 4, p2);
    const keyStr = CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Hex.parse(keyHex));
    const iv   = fromHex(data.slice(-32));
    const cipher = fromHex(data.slice(p2 + 4, -32));
    const d = CryptoJS.AES.decrypt({ciphertext:cipher}, pad16(keyStr), {iv, mode:CryptoJS.mode.CBC, padding:CryptoJS.pad.Pkcs7});
    const plain = d.toString(CryptoJS.enc.Utf8);
    if (!plain) return alert('è§£å¯†å¤±è´¥ï¼Œæ£€æŸ¥å¯†é’¥æˆ–å¯†æ–‡');
    document.getElementById('out').value = plain;
};

/* ---------- ä¸‹è½½ ---------- */
document.getElementById('btnDown').onclick = () => {
    if (!lastCipher) return alert('è¯·å…ˆåŠ å¯†ï¼');
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([lastCipher], {type:'text/plain'}));
    a.download = 'jk.txt';
    a.click();
};

/* ---------- å¤åˆ¶ ---------- */
document.getElementById('btnCopy').onclick = function () {
    const o = document.getElementById('out');
    o.select();
    document.execCommand('copy');
    const t = this.textContent; this.textContent = 'å·²å¤åˆ¶ï¼';
    setTimeout(() => this.textContent = t, 1200);
};

/* ---------- æ¸…é™¤ ---------- */
document.getElementById('btnClear').onclick = () => {
    document.getElementById('in').value = '';
    document.getElementById('out').value = '';
    lastCipher = '';
};

/* ---------- ä¸Šä¼  ---------- */
document.getElementById('upload').addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        document.getElementById('in').value = reader.result;
    };
    reader.readAsText(file);
});
</script>
</body>
</html>